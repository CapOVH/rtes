<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CapTcha Rewards</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 min-h-screen flex items-center justify-center text-white">

<div class="bg-slate-800 p-8 rounded-xl w-full max-w-md text-center">

<h1 class="text-3xl font-bold mb-4">üé∞ CapTcha Rewards</h1>

<!-- LOGIN -->
<div id="loginBox">
  <input id="key" placeholder="Enter your license key"
    class="w-full p-3 rounded bg-slate-700 mb-4"/>
  <button onclick="login()"
    class="w-full bg-indigo-600 py-3 rounded font-bold">
    Login
  </button>
</div>

<!-- GAME -->
<div id="gameBox" class="hidden">
  <p class="mb-2">Points: <span id="points">0</span></p>

  <select id="bet" class="w-full p-2 bg-slate-700 rounded mb-3">
    <option value="10">10 pts</option>
    <option value="25">25 pts</option>
    <option value="50">50 pts</option>
  </select>

  <div class="flex justify-center text-5xl mb-4">
    <span id="r1">‚ùì</span>
    <span id="r2">‚ùì</span>
    <span id="r3">‚ùì</span>
  </div>

  <button onclick="spin()"
    class="w-full bg-emerald-600 py-3 rounded font-bold">
    Spin
  </button>

  <p id="result" class="mt-3"></p>

  <a href="/redeem.html" class="block mt-4 underline">Redeem Points</a>
</div>

</div>

<script>
async function login() {
  const res = await fetch("/api/login", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ key: key.value })
  });
  const d = await res.json();
  if (d.ok) load();
  else alert("Invalid key");
}

async function load() {
  const r = await fetch("/api/me");
  const d = await r.json();
  if (!d.ok) return;
  loginBox.classList.add("hidden");
  gameBox.classList.remove("hidden");
  points.innerText = d.points;
}

async function spin() {
  const betVal = bet.value;
  result.innerText = "Spinning...";
  const r = await fetch("/api/spin", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ bet: betVal })
  });
  const d = await r.json();
  if (!d.ok) return alert(d.error);
  result.innerText = d.win ? `üéâ Won ${d.payout} pts!` : "‚ùå Lost";
  load();
}

load();
</script>
</body>
</html>
